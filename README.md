# video_duplicate_finder
Creates 64-bit hashes of videos and compares them.

It uses the Python library videohash (https://pypi.org/project/videohash/).  
Install it before using the Python scripts,  
and ffmpeg must be installed and added to the system PATH variable.

## calculatehash.py
Gets all video files from the given directory, calculates the video hash, and stores it in a JSON file with the filepath, hash, and filesize.  
It can be interrupted. Calling it again with the same parameters will continue where it stopped.

It uses ffprobe to get the video duration, so it can calculate how many frames need to be skipped. Since always only 64 screenshots are created, distributed evenly through the whole video, the video hash is calculated based on them.

Parameters:
- directory: Directory containing video files with the endings "'.mp4', '.avi', '.mkv', '.mov', '.wmv', '.flv', '.webm', '.m4v', '.mpg', '.mpeg'". It also includes subdirectories.
- --output, '-o': Output JSON file, default is 'video_hashes.json'.

```powershell
python calculatehash.py c:\MyVideoFolder\ -o video_hashes.json
```

## check.py
This Python script can read the JSON file created from calculatehash.py. It checks for each entry in the JSON if the file still exists and if it has the same filesize. If not, the entry gets removed.  
NOTE: The script does NOT modify the original JSON file; it creates a copy with the same name and adds "_valid.json" to it.

```powershell
python check.py video_hashes.json
```

## hammingsort.py
This Python script can read the JSON file created from calculatehash.py and calculate the Hamming distance for each possible pair of entries. It starts with the first entry and calculates Hamming values between the first entry and all other entries. Then it sorts this list and picks the top 3 of the list. Then it removes the first entry from the list and repeats the process.  
A minimum Hamming distance as a threshold can be given (from 0-63). Any calculated Hamming distance above the threshold will be discarded.  
The result is a list of groups which contains 2 to 4 video paths: 1 first entry which was compared against and up to 3 most minimum Hamming distance hashes.
 
Parameters:
- --input, -i: Input JSON file (default: video_hashes.json)
- --threshold, -t: Threshold for Hamming distance (0-63) (default: 5)
- --verbose, -v: Enable verbose output (optional)

Prints the results to console:
```powershell
python hammingsort.py -i video_hashes.json -t 10 -v
```

Creates a "review.txt" file which can be read by play.ps1:
```powershell
python hammingsort.py -i video_hashes.json -t 10 > review.txt
```

## play.ps1
Takes a text file generated by hammingsort.py (see above) and plays the video with the player mpv (https://mpv.io/) group by group, so the videos can be compared manually if they are really duplicates.  
In mpv, a shortcut can be added to remove the video file from disk.

Parameters:
- InputFilePath: The list of found and calculated Hamming distance groups (see above).

```powershell
play.ps1 -InputFilePath review.txt
```
NOTE: mpv must be installed and added to the PATH environment variable.